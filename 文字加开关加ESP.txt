local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local GuiService = game:GetService("GuiService")

-- åˆ›å»ºScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ColorChangingText"
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 999  -- ç¡®ä¿åœ¨æœ€å‰é¢æ˜¾ç¤º
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- åˆ›å»ºæ–‡æœ¬æ ‡ç­¾
local textLabel = Instance.new("TextLabel")
textLabel.Size = UDim2.new(1, 0, 1, 0)
textLabel.Position = UDim2.new(0, 0, 0, 0)
textLabel.BackgroundTransparency = 1
textLabel.Text = "ğŸ¦æ¬¢è¿ä½¿ç”¨ESPï¼Œæ­£åœ¨ä¸ºæ‚¨æ‰«æå…¨å›¾ğŸ¦"
textLabel.Font = Enum.Font.SourceSansBold
textLabel.TextSize = 36
textLabel.TextColor3 = Color3.new(1, 1, 1)
textLabel.TextStrokeTransparency = 0.5
textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
textLabel.ZIndex = 10
textLabel.Parent = screenGui

-- è°ƒæ•´æ–‡æœ¬ä½ç½®ä½¿å…¶å±…ä¸­
textLabel.AnchorPoint = Vector2.new(0.5, 0.5)
textLabel.Position = UDim2.new(0.5, 0, 0.5, 0)

-- é¢œè‰²å˜åŒ–å‡½æ•°
local function changeColor()
    local time = 0
    local duration = 5 -- 5ç§’
    
    while time < duration do
        local hue = (tick() * 24) % 360
        textLabel.TextColor3 = Color3.fromHSV(hue/360, 1, 1)
        wait(0.05)
        time = time + 0.05
    end
    
    -- 5ç§’åç§»é™¤
    screenGui:Destroy()
end

-- å¯åŠ¨é¢œè‰²å˜åŒ–
coroutine.wrap(changeColor)()

-- â–¼â–¼â–¼ ä»¥ä¸‹æ˜¯ç¬¬äºŒä¸ªESPè„šæœ¬ â–¼â–¼â–¼
-- ç­‰å¾…5ç§’è„šæœ¬ï¼ˆé€‚ç”¨äºDeltaæ³¨å…¥å™¨ï¼‰
local waitTime = 5 -- ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰
local startTime = tick()

print("â³ è„šæœ¬å°†åœ¨ "..waitTime.." ç§’åå¼€å§‹æ‰§è¡Œ...")

while tick() - startTime < waitTime do
    -- æ¯éš”1ç§’æ‰“å°ä¸€æ¬¡å‰©ä½™æ—¶é—´
    local remaining = math.floor(waitTime - (tick() - startTime))
    if remaining ~= lastRemaining then
        print("ğŸ•’ å‰©ä½™æ—¶é—´: "..remaining.."ç§’")
        lastRemaining = remaining
    end
    wait(0.1)
end

print("âœ… ç­‰å¾…ç»“æŸï¼Œå¼€å§‹æ‰§è¡Œä¸»è„šæœ¬...")

-- åœ¨è¿™é‡Œæ‹¼æ¥ä½ çš„ä¸»è„šæœ¬
-- ä½ çš„ä¸»è„šæœ¬å†…å®¹ä»è¿™é‡Œå¼€å§‹...
-- ===== åŸå§‹ESPè„šæœ¬ä¿æŒä¸å˜ =====
-- é«˜çº§ESPè„šæœ¬ v2.3 - ä¼˜åŒ–ç‰ˆï¼ˆç›‘æµ‹èŒƒå›´1000å•ä½ï¼‰
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- ===== é…ç½®åŒºåŸŸ =====
local SETTINGS = {
    -- æ•Œäººè®¾ç½®
    ENEMY_TAGS = {"Rake", "Monster", "Enemy"},
    ENEMY_COLOR = Color3.fromRGB(255, 50, 50),
    
    -- ç©å®¶è®¾ç½®
    PLAYER_COLOR = Color3.fromRGB(50, 150, 255),
    TEAM_COLOR = Color3.fromRGB(50, 255, 100),
    
    -- æ˜¾ç¤ºè®¾ç½®
    SHOW_HEALTH = true,
    SHOW_DISTANCE = true,
    SHOW_TRACER = true,
    TRACER_COLOR = Color3.fromRGB(0, 150, 255),
    ENEMY_TRACER_COLOR = Color3.fromRGB(255, 50, 50),
    TRACER_THICKNESS = 0.1,
    
    -- é«˜çº§è®¾ç½®
    MAX_DISTANCE = 1000,  -- å·²ä¿®æ”¹ä¸º1000å•ä½
    HEALTH_TEXT_SIZE = 16,
    DISTANCE_TEXT_SIZE = 14,
    NAME_TEXT_SIZE = 18,
    UPDATE_RATE = 0.001,
    
    -- æ–°å¢è®¾ç½®
    SCAN_INTERVAL = 5,
    TRACER_FOR_ENEMIES = true
}

-- ===== æ ¸å¿ƒåŠŸèƒ½ =====
local espCache = {}
local lastScanTime = 0

local function createESP(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    
    if espCache[target] then return end
    
    local isEnemy = false
    local isTeammate = false
    local espColor = SETTINGS.PLAYER_COLOR
    
    for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
        if target.Name:find(tag) or target:FindFirstChild(tag) then
            isEnemy = true
            espColor = SETTINGS.ENEMY_COLOR
            break
        end
    end
    
    if not isEnemy and target:FindFirstChild("Team") then
        if LocalPlayer.Team and target.Team == LocalPlayer.Team then
            isTeammate = true
            espColor = SETTINGS.TEAM_COLOR
        end
    end
    
    local highlight = Instance.new("Highlight")
    highlight.Name = "AdvancedESP_Highlight"
    highlight.FillColor = espColor
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.3
    highlight.OutlineTransparency = 0
    highlight.Parent = target
    
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "AdvancedESP_Billboard"
    billboard.Adornee = target.HumanoidRootPart
    billboard.Size = UDim2.new(0, 150, 0, 60)
    billboard.StudsOffset = Vector3.new(0, 3.5, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = target
    
    local distanceText = Instance.new("TextLabel")
    distanceText.Name = "ESP_Distance"
    distanceText.Size = UDim2.new(1, 0, 0.3, 0)
    distanceText.Position = UDim2.new(0, 0, 0, 0)
    distanceText.BackgroundTransparency = 1
    distanceText.TextColor3 = Color3.fromRGB(200, 200, 255)
    distanceText.TextStrokeTransparency = 0.5
    distanceText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    distanceText.TextSize = SETTINGS.DISTANCE_TEXT_SIZE
    distanceText.Font = Enum.Font.SourceSansBold
    distanceText.TextXAlignment = Enum.TextXAlignment.Center
    distanceText.Parent = billboard
    
    local healthText = Instance.new("TextLabel")
    healthText.Name = "ESP_Health"
    healthText.Size = UDim2.new(1, 0, 0.4, 0)
    healthText.Position = UDim2.new(0, 0, 0.3, 0)
    healthText.BackgroundTransparency = 1
    healthText.TextColor3 = Color3.fromRGB(255, 255, 255)
    healthText.TextStrokeTransparency = 0.5
    healthText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    healthText.TextSize = SETTINGS.HEALTH_TEXT_SIZE
    healthText.Font = Enum.Font.SourceSansBold
    healthText.TextXAlignment = Enum.TextXAlignment.Center
    healthText.Parent = billboard
    
    local nameText = Instance.new("TextLabel")
    nameText.Name = "ESP_Name"
    nameText.Size = UDim2.new(1, 0, 0.3, 0)
    nameText.Position = UDim2.new(0, 0, 0.7, 0)
    nameText.BackgroundTransparency = 1
    nameText.TextColor3 = espColor
    nameText.TextStrokeTransparency = 0.5
    nameText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameText.TextSize = SETTINGS.NAME_TEXT_SIZE
    nameText.Font = Enum.Font.SourceSansBold
    nameText.TextXAlignment = Enum.TextXAlignment.Center
    nameText.Parent = billboard
    
    local tracer
    if SETTINGS.SHOW_TRACER and (not isEnemy or SETTINGS.TRACER_FOR_ENEMIES) then
        local startAttachment = Instance.new("Attachment")
        startAttachment.Name = "TracerStart"
        startAttachment.Parent = workspace.CurrentCamera
        
        local endAttachment = Instance.new("Attachment")
        endAttachment.Name = "TracerEnd"
        endAttachment.Parent = target.HumanoidRootPart
        
        tracer = Instance.new("Beam")
        tracer.Name = "ESP_Tracer"
        tracer.Attachment0 = startAttachment
        tracer.Attachment1 = endAttachment
        tracer.Color = ColorSequence.new(isEnemy and SETTINGS.ENEMY_TRACER_COLOR or SETTINGS.TRACER_COLOR)
        tracer.Width0 = SETTINGS.TRACER_THICKNESS
        tracer.Width1 = SETTINGS.TRACER_THICKNESS * 0.8
        tracer.LightEmission = 0.8
        tracer.Transparency = NumberSequence.new(0.5)
        tracer.FaceCamera = true
        tracer.Parent = target.HumanoidRootPart
    end
    
    espCache[target] = {
        highlight = highlight,
        billboard = billboard,
        tracer = tracer,
        humanoid = target:FindFirstChildOfClass("Humanoid"),
        rootPart = target.HumanoidRootPart,
        startAttachment = tracer and tracer.Attachment0,
        endAttachment = tracer and tracer.Attachment1,
        isEnemy = isEnemy
    }
end

local function fullScan()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            createESP(player.Character)
        end
    end
    
    for _, descendant in ipairs(workspace:GetDescendants()) do
        if descendant:IsA("Model") and descendant:FindFirstChild("HumanoidRootPart") then
            for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
                if descendant.Name:find(tag) or descendant:FindFirstChild(tag) then
                    createESP(descendant)
                    break
                end
            end
        end
    end
end

-- ===== æ›´æ–°å¾ªç¯ =====
local lastUpdate = 0
local espEnabled = true  -- æ–°å¢ï¼šESPå¼€å…³çŠ¶æ€å˜é‡

RunService.Heartbeat:Connect(function(deltaTime)
    lastUpdate = lastUpdate + deltaTime
    lastScanTime = lastScanTime + deltaTime
    
    -- å¦‚æœESPè¢«ç¦ç”¨ï¼Œç›´æ¥è·³è¿‡æ‰€æœ‰æ›´æ–°
    if not espEnabled then return end
    
    if lastScanTime >= SETTINGS.SCAN_INTERVAL then
        lastScanTime = 0
        fullScan()
    end
    
    if lastUpdate < SETTINGS.UPDATE_RATE then return end
    lastUpdate = 0
    
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    local localRoot = LocalPlayer.Character.HumanoidRootPart
    
    for target, data in pairs(espCache) do
        if not target.Parent then
            if data.highlight then data.highlight:Destroy() end
            if data.billboard then data.billboard:Destroy() end
            if data.tracer then data.tracer:Destroy() end
            espCache[target] = nil
        else
            local distance = (data.rootPart.Position - localRoot.Position).Magnitude
            local shouldShow = distance <= SETTINGS.MAX_DISTANCE
            
            data.highlight.Enabled = shouldShow
            data.billboard.Enabled = shouldShow
            
            if data.tracer then
                data.tracer.Enabled = shouldShow
                if data.startAttachment then
                    data.startAttachment.WorldPosition = localRoot.Position - Vector3.new(0, 1.5, 0)
                end
            end
            
            if shouldShow then
                if SETTINGS.SHOW_DISTANCE then
                    data.billboard.ESP_Distance.Text = string.format("%.1fm", distance/3.571)
                else
                    data.billboard.ESP_Distance.Text = ""
                end
                
                if SETTINGS.SHOW_HEALTH and data.humanoid then
                    data.billboard.ESP_Health.Text = string.format("HP: %d/%d", 
                        math.floor(data.humanoid.Health), 
                        math.floor(data.humanoid.MaxHealth))
                else
                    data.billboard.ESP_Health.Text = ""
                end
                
                data.billboard.ESP_Name.Text = target.Name
            end
        end
    end
end)

-- ===== åˆå§‹åŒ–å’Œäº‹ä»¶ç›‘å¬ =====
fullScan()

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        if espEnabled then  -- æ–°å¢ï¼šä»…åœ¨ESPå¯ç”¨æ—¶åˆ›å»º
            createESP(character)
        end
    end)
end)

workspace.DescendantAdded:Connect(function(descendant)
    if descendant:IsA("Model") and descendant:FindFirstChild("HumanoidRootPart") then
        for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
            if descendant.Name:find(tag) or descendant:FindFirstChild(tag) then
                if espEnabled then  -- æ–°å¢ï¼šä»…åœ¨ESPå¯ç”¨æ—¶åˆ›å»º
                    createESP(descendant)
                end
                break
            end
        end
    end
end)

LocalPlayer.CharacterRemoving:Connect(function()
    for _, data in pairs(espCache) do
        if data.highlight then data.highlight:Destroy() end
        if data.billboard then data.billboard:Destroy() end
        if data.tracer then data.tracer:Destroy() end
    end
    espCache = {}
end)

-- ===== æ–°å¢ï¼šESPå¼€å…³GUI =====
local function createToggleGUI()
    -- åˆ›å»ºä¸»GUIå®¹å™¨
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ESPToggleGUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    -- ä¸»æ¡†æ¶
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 100, 0, 40)
    mainFrame.Position = UDim2.new(1, -110, 0, 20)  -- å³ä¸Šè§’ä½ç½®
    mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    mainFrame.BackgroundTransparency = 0.3
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    -- åœ†è§’æ•ˆæœ
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0.2, 0)
    corner.Parent = mainFrame
    
    -- å¼€å…³æŒ‰é’®
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "ToggleButton"
    toggleButton.Size = UDim2.new(0.9, 0, 0.7, 0)
    toggleButton.Position = UDim2.new(0.05, 0, 0.15, 0)
    toggleButton.BackgroundColor3 = espEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(200, 50, 50)
    toggleButton.Text = espEnabled and "ESPå¼€å¯ä¸­" or "ESPå…³é—­ä¸­"
    toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleButton.TextSize = 16
    toggleButton.Font = Enum.Font.SourceSansBold
    toggleButton.AutoButtonColor = true
    toggleButton.Parent = mainFrame
    
    -- æŒ‰é’®åœ†è§’
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0.15, 0)
    buttonCorner.Parent = toggleButton
    
    -- å¼€å…³åŠŸèƒ½å®ç°
    toggleButton.MouseButton1Click:Connect(function()
        espEnabled = not espEnabled
        
        -- æ›´æ–°æŒ‰é’®çŠ¶æ€
        toggleButton.BackgroundColor3 = espEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(200, 50, 50)
        toggleButton.Text = espEnabled and "ESPå¼€å¯ä¸­" or "ESPå…³é—­ä¸­"
        
        if not espEnabled then
            -- ç¦ç”¨ESPæ—¶æ¸…é™¤æ‰€æœ‰å½“å‰ESPå…ƒç´ 
            for _, data in pairs(espCache) do
                if data.highlight then data.highlight:Destroy() end
                if data.billboard then data.billboard:Destroy() end
                if data.tracer then data.tracer:Destroy() end
            end
            espCache = {}
        else
            -- é‡æ–°å¯ç”¨æ—¶æ‰§è¡Œå…¨æ‰«æ
            fullScan()
        end
    end)
    
    -- å¯æ‹–åŠ¨åŠŸèƒ½
    local dragging
    local dragInput
    local dragStart
    local startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    
    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    mainFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
    
    return screenGui
end

-- åˆ›å»ºå¼€å…³GUI
createToggleGUI()